{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/raffle","result":{"data":{"site":{"siteMetadata":{"title":"June"}},"markdownRemark":{"id":"7a905898-6fd0-5a71-98ce-148272b30e4a","excerpt":"전 개인적으로 신발에 관심이 많습니다. 이미 많이 알려진 Kream 서비스에서는 발매된 신발들의 가격이\n희소성으로 인해 몇배씩 뛰곤 하는데요. 선물을 위해 에어포스 화이트를 사려고 하다가 인스타에 발매 정보를 공지하는 것을 보고 알림을 주는 bot…","html":"<p>전 개인적으로 신발에 관심이 많습니다. 이미 많이 알려진 <a href=\"https://kream.co.kr/\" target=\"_blank\" rel=\"noopener\">Kream</a> 서비스에서는 발매된 신발들의 가격이\n희소성으로 인해 몇배씩 뛰곤 하는데요. 선물을 위해 에어포스 화이트를 사려고 하다가 인스타에 발매 정보를 공지하는 것을 보고 알림을 주는 bot을 만들어보았습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a09911e83778d3fd84670cf0a2a574e1/66fdb/airforce.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd6ECKD/xAAXEAEBAQEAAAAAAAAAAAAAAAAAEgER/9oACAEBAAEFAuu6tCUY/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEQITH/2gAIAQEABj8CnDGa5//EAB0QAAIBBAMAAAAAAAAAAAAAAAABERAhQVFxgcH/2gAIAQEAAT8hfYtUpJ4tMm/A5z//2gAMAwEAAgADAAAAEBAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITFBUYGR/9oACAEBAAE/EBDPiOwQObqDV6XlMbepc2MS1h4EAO3uf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"airforce\"\n        title=\"airforce\"\n        src=\"/static/a09911e83778d3fd84670cf0a2a574e1/7cc5e/airforce.jpg\"\n        srcset=\"/static/a09911e83778d3fd84670cf0a2a574e1/e439a/airforce.jpg 120w,\n/static/a09911e83778d3fd84670cf0a2a574e1/09b79/airforce.jpg 240w,\n/static/a09911e83778d3fd84670cf0a2a574e1/7cc5e/airforce.jpg 480w,\n/static/a09911e83778d3fd84670cf0a2a574e1/80e3c/airforce.jpg 720w,\n/static/a09911e83778d3fd84670cf0a2a574e1/6a068/airforce.jpg 960w,\n/static/a09911e83778d3fd84670cf0a2a574e1/66fdb/airforce.jpg 1250w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<p>서현, 강남 등등의 nike store별로 있는 인스타그램 계정에서 <code class=\"language-text\">raffle을 하는 경우, feed</code>가 올라옵니다. 그리고 <code class=\"language-text\">선착순 구매를 하는 경우, story</code> 가 올라옵니다.\n그래서 feed가 올라올 때, story가 올라올 때 telegram으로 알림을 주는 봇을 생각하게 되었습니다.</p>\n<p>처음엔 crowling을 통해 특정 html 태그 내부의 정보를 긁어가려고 했으나, crowling을 하면 데이터가 렌더링 되지 않은 html 정보들만 긁어져 왔습니다.\nssr을 하는게 아닌 것 같네요. 따라서 api를 사용할 수 밖에 없었습니다.</p>\n<p>instagram에서는 공식적으로 api를 제공하지 않습니다. 이 api를 찾는 과정이 오래걸렸습니다. (방법이 있는건 아니고 삽질을 통해...)\n또한 feed와 story에 대한 api는 성격이 완전히 달라보였습니다. story는 session정보가 필요했고, feed는 session정보가 필요하지 않았습니다.\nstory는 권한이 없으면 아무것도 노출되지 않고, feed는 공개유저에 대해선 권한이 없어도 노출되기 때문이 아닐까 생각했습니다.</p>\n<p>raffle은 짧으면 30분 정도 진행했기 때문에 15분마다 돌아가는 cronjob을 통해 실행되게 해놨고,\n선착순 구매는 시간이 생명이기 때문에...! 5분마다 cronjob을 돌게 해놨습니다.</p>\n<p>조회해온 feed, story 정보는 object에 저장해놓고 cron을 통해 다음 실행으로 받아온 정보와 비교합니다. (isFirst 플래그를 통해 처음 조회 시에는 무조건 저장만 하게 합니다.)\n비교 시, 데이터가 달라진다면 세팅된 텔레그램으로 알림을 보내게 됩니다. 이렇게 이전 객체와 비교만 하면 되니 DB에 데이터를 저장할 필요도 없습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d3afabbbd82343edf500a5d196e72ca3/bc4e4/bot.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeMlMoLoMg//xAAZEAACAwEAAAAAAAAAAAAAAAABMQACECH/2gAIAQEAAQUCHScq7OB5/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAGhAAAwADAQAAAAAAAAAAAAAAAAEhESAxUf/aAAgBAQABPyFnV5JcMv046A70Z//aAAwDAQACAAMAAAAQYA88/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAGxABAAICAwAAAAAAAAAAAAAAAQARUWEgITH/2gAIAQEAAT8QMDWyzypJscBOgkW6EHrE/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bot\"\n        title=\"bot\"\n        src=\"/static/d3afabbbd82343edf500a5d196e72ca3/7cc5e/bot.jpg\"\n        srcset=\"/static/d3afabbbd82343edf500a5d196e72ca3/e439a/bot.jpg 120w,\n/static/d3afabbbd82343edf500a5d196e72ca3/09b79/bot.jpg 240w,\n/static/d3afabbbd82343edf500a5d196e72ca3/7cc5e/bot.jpg 480w,\n/static/d3afabbbd82343edf500a5d196e72ca3/80e3c/bot.jpg 720w,\n/static/d3afabbbd82343edf500a5d196e72ca3/6a068/bot.jpg 960w,\n/static/d3afabbbd82343edf500a5d196e72ca3/bc4e4/bot.jpg 2118w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Github: <a href=\"https://github.com/jicjjang/nike-raffle-notifier\" target=\"_blank\" rel=\"noopener\">nike-raffle-notifier</a></p>","frontmatter":{"title":"나이키 인스타 tracking 사이드 프로젝트","date":"March 20, 2022","tags":["nike","raffle","sideproject","node"]}}},"pageContext":{"slug":"/posts/raffle","previous":{"fields":{"slug":"/posts/tail-call-tail-recursion"},"frontmatter":{"title":"Tail call과 Tail recursion"}},"next":{"fields":{"slug":"/posts/react-server-component"},"frontmatter":{"title":"React-server-component"}}}},"staticQueryHashes":["1576648375","1963346411"]}